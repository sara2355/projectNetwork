/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */


/**
 *
 * @author ayase
 */

import java.awt.*;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;
import javax.swing.*;


public class Client {
    private static final String SERVER_IP = "localhost";
    private static final int SERVER_PORT = 9090;
    
    private JFrame startFrame, loginFrame, playersFrame, waitingRoomFrame, gameFrame;
    private DefaultListModel<String> playerListModel, waitingRoomListModel, scoreModel;
    private JList<String> playerList, waitingRoomList, scoreList;
    private PrintWriter out;
    private BufferedReader in;
    private String username;
private JLabel waitingRoomTimerLabel;
private JLabel gameTimerLabel;

  private JLabel questionLabel;
private JPanel answerButtonsPanel;


    public Client() {
        showStartWindow();
    }
//start gui
    
    
    
    // Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    private void showStartWindow() {
    startFrame = new JFrame("Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©");
    startFrame.setSize(800, 600); // Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ØµÙˆØ±Ø©
    startFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    startFrame.setLocationRelativeTo(null); // ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©

    // ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
    ImageIcon backgroundIcon = new ImageIcon(getClass().getResource("start.png"));
    JLabel backgroundLabel = new JLabel(backgroundIcon);
    backgroundLabel.setLayout(null); // Ù†ØªØ­ÙƒÙ… ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¨Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª

    // Ø§Ù„Ù†Øµ Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠ "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø®ÙØ²Ø¹Ø¨ÙÙ„ÙØ©!"
    JLabel welcomeLabel = new JLabel("Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø®ÙØ²Ø¹Ø¨ÙÙ„ÙØ©!", SwingConstants.CENTER);
    welcomeLabel.setFont(new Font("Arial", Font.BOLD, 24));
    welcomeLabel.setForeground(Color.darkGray);
    welcomeLabel.setBounds(250, 220, 300, 30); // Ø§Ù„Ù…ÙƒØ§Ù† Ø¨Ø§Ù„Ù…Ù†ØªØµÙ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§

    // Ø²Ø± "Ø§Ø¨Ø¯Ø£" Ø£Ø³ÙÙ„ Ø§Ù„Ù†ØµØŒ ØµØºÙŠØ±ØŒ ÙƒØ­Ù„ÙŠØŒ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
    JButton startButton = new JButton("Ø§Ø¨Ø¯Ø£");
    startButton.setFont(new Font("Arial", Font.BOLD, 16));
    startButton.setBackground(new Color(10, 30, 60)); // ÙƒØ­Ù„ÙŠ
    startButton.setForeground(Color.WHITE);
    startButton.setFocusPainted(false);
    startButton.setBounds(360, 280, 80, 35); // Ø£Ø³ÙÙ„ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ ØµØºÙŠØ± ÙˆÙ…ÙÙ†ØªØµÙ

    startButton.addActionListener(e -> {
        startFrame.dispose();
        showLoginWindow();
    });

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
    backgroundLabel.add(welcomeLabel);
    backgroundLabel.add(startButton);

    // ÙˆØ¶Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙƒÙ€ ContentPane
    startFrame.setContentPane(backgroundLabel);
    startFrame.setVisible(true);
}


    // Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    private void showLoginWindow() {
    loginFrame = new JFrame("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    loginFrame.setSize(800, 600);
    loginFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    loginFrame.setLocationRelativeTo(null); // ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©

    // ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
    ImageIcon backgroundIcon = new ImageIcon(getClass().getResource("gamee.png"));
    JLabel backgroundLabel = new JLabel(backgroundIcon);
    backgroundLabel.setLayout(null); // Ù†ØªØ­ÙƒÙ… ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙÙŠ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ±

    // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
    JLabel nameLabel = new JLabel("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ:", SwingConstants.CENTER);
    nameLabel.setFont(new Font("Arial", Font.BOLD, 24));
    nameLabel.setForeground(Color.DARK_GRAY);
    nameLabel.setBounds(275, 170, 250, 40); // Ø£Ø¹Ù„Ù‰ Ù…Ù†ØªØµÙ Ø§Ù„Ù†Ø§ÙØ°Ø©

    // Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø£Ø³ÙÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    JTextField nameField = new JTextField();
    nameField.setFont(new Font("Arial", Font.PLAIN, 18));
    nameField.setBounds(250, 220, 300, 40); // Ø£Ø³ÙÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø¨Ø§Ø´Ø±Ø©

    // Ø²Ø± "Ø§ØªØµÙ„"
    JButton connectButton = new JButton("Ø§ØªØµÙ„");
    connectButton.setFont(new Font("Arial", Font.BOLD, 18));
    connectButton.setBackground(new Color(10, 30, 60)); // ÙƒØ­Ù„ÙŠ
    connectButton.setForeground(Color.WHITE);
    connectButton.setFocusPainted(false);
    connectButton.setBounds(350, 300, 100, 40); // Ø£Ø³ÙÙ„ Ø®Ø§Ù†Ø© Ø§Ù„Ø§Ø³Ù…

    connectButton.addActionListener(e -> {
        username = nameField.getText().trim();
        if (!username.isEmpty()) {
            loginFrame.dispose();
            connectToServer();
            showPlayersWindow();
        }
    });

    // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ø´ÙŠØ¡ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
    backgroundLabel.add(nameLabel);
    backgroundLabel.add(nameField);
    backgroundLabel.add(connectButton);

    loginFrame.setContentPane(backgroundLabel);
    loginFrame.setVisible(true);
}


    // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
    private void connectToServer() {
        try {
            Socket socket = new Socket(SERVER_IP, SERVER_PORT);
            out = new PrintWriter(socket.getOutputStream(), true);
            in  = new BufferedReader(new InputStreamReader(socket.getInputStream()));
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ù„Ø³ÙŠØ±ÙØ±
            out.println(username);
            
            // Ø¨Ø¯Ø¡ Thread Ù„Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±
            new Thread(() -> {
                try {
                    String serverMessage;
                    while ((serverMessage = in.readLine()) != null) {
                        processMessage(serverMessage);
                    }
                } catch (IOException e) {
                    System.err.println("ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
                }
            }).start();
        } catch (IOException e) {
            JOptionPane.showMessageDialog(null, "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…!", "Ø®Ø·Ø£", JOptionPane.ERROR_MESSAGE);
        }
    }

    // Ù†Ø§ÙØ°Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    private void showPlayersWindow() {
    playersFrame = new JFrame("Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†");
    playersFrame.setSize(800, 600);
    playersFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    playersFrame.setLocationRelativeTo(null); // ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©

    // ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
    ImageIcon backgroundIcon = new ImageIcon(getClass().getResource("gamee.png"));
    JLabel backgroundLabel = new JLabel(backgroundIcon);
    backgroundLabel.setLayout(null); // Ù†ØªØ­ÙƒÙ… ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙÙŠ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ±

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    playerListModel = new DefaultListModel<>();
    playerList = new JList<>(playerListModel);
    playerList.setFont(new Font("Arial", Font.BOLD, 24));
    playerList.setOpaque(false); // Ø´ÙØ§ÙÙŠØ©
    playerList.setForeground(Color.WHITE);
    playerList.setBackground(new Color(0, 0, 0, 0));

    // ØªÙ†Ø³ÙŠÙ‚ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
    playerList.setCellRenderer(new DefaultListCellRenderer() {
        @Override
        public Component getListCellRendererComponent(JList<?> list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {
            JLabel label = (JLabel) super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);
            label.setHorizontalAlignment(SwingConstants.CENTER);
            label.setForeground(Color.WHITE);
            label.setFont(new Font("Arial", Font.BOLD, 24));
            label.setOpaque(false);
            return label;
        }
    });

    JScrollPane playersScrollPane = new JScrollPane(playerList);
    playersScrollPane.setBounds(250, 140, 300, 300); // ÙˆØ³Ø· Ø§Ù„Ø´Ø§Ø´Ø© ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§
    playersScrollPane.setOpaque(false);
    playersScrollPane.getViewport().setOpaque(false);
    playersScrollPane.setBorder(null);

    // Ø²Ø± "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨"
    JButton playButton = new JButton("Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨");
    playButton.setFont(new Font("Arial", Font.BOLD, 18));
    playButton.setBackground(new Color(10, 30, 60)); // ÙƒØ­Ù„ÙŠ
    playButton.setForeground(Color.WHITE);
    playButton.setFocusPainted(false);
    playButton.setBounds(325, 460, 150, 40); // ØªØ­Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

    playButton.addActionListener(e -> {
        sendPlayRequest();
        playersFrame.dispose();
        showWaitingRoom();
    });

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù„Ø®Ù„ÙÙŠØ©
    backgroundLabel.add(playersScrollPane);
    backgroundLabel.add(playButton);

    playersFrame.setContentPane(backgroundLabel);
    playersFrame.setVisible(true);
}



    // Ù†Ø§ÙØ°Ø© ØºØ±ÙØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
   private void showWaitingRoom() {
    waitingRoomFrame = new JFrame("ØºØ±ÙØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±");
    waitingRoomFrame.setSize(800, 600);
    waitingRoomFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    waitingRoomFrame.setLocationRelativeTo(null);

    // ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
    ImageIcon backgroundIcon = new ImageIcon(getClass().getResource("gamee.png"));
    JLabel backgroundLabel = new JLabel(backgroundIcon);
    backgroundLabel.setLayout(null); // ØªØ­ÙƒÙ… ÙŠØ¯ÙˆÙŠ

    // Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ù„ÙˆÙŠ
    waitingRoomTimerLabel = new JLabel(" Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§...", SwingConstants.LEFT);
    waitingRoomTimerLabel.setFont(new Font("Arial", Font.BOLD, 18));
    waitingRoomTimerLabel.setForeground(Color.WHITE);
    waitingRoomTimerLabel.setBounds(5, 5, 200, 50); // Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
    waitingRoomListModel = new DefaultListModel<>();
    waitingRoomList = new JList<>(waitingRoomListModel);
    waitingRoomList.setFont(new Font("Arial", Font.BOLD, 24));
    waitingRoomList.setOpaque(false);
    waitingRoomList.setForeground(Color.WHITE);
    waitingRoomList.setBackground(new Color(0, 0, 0, 0));

    // ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø§Ù„Ù…Ù†ØªØµÙ
    waitingRoomList.setCellRenderer(new DefaultListCellRenderer() {
        @Override
        public Component getListCellRendererComponent(JList<?> list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {
            JLabel label = (JLabel) super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);
            label.setHorizontalAlignment(SwingConstants.CENTER);
            label.setForeground(Color.DARK_GRAY);
            label.setFont(new Font("Arial", Font.BOLD, 24));
            label.setOpaque(false);
            return label;
        }
    });

    JScrollPane waitingScrollPane = new JScrollPane(waitingRoomList);
    waitingScrollPane.setBounds(250, 140, 300, 300);
    waitingScrollPane.setOpaque(false);
    waitingScrollPane.getViewport().setOpaque(false);
    waitingScrollPane.setBorder(null);

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª
    backgroundLabel.add(waitingRoomTimerLabel);
    backgroundLabel.add(waitingScrollPane);

    waitingRoomFrame.setContentPane(backgroundLabel);
    waitingRoomFrame.setVisible(true);
}

   


    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
    private void sendAnswer(boolean isCorrect) {
        if (out != null) {
            out.println("ANSWER: " + (isCorrect ? "true" : "false"));
        }
    }

    // Ø¨Ø¯Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
  
private void startGameWindow(String[] players) {
    gameFrame = new JFrame("ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø©");
    gameFrame.setSize(800, 600);
    gameFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    gameFrame.setLocationRelativeTo(null);

    // ====== Ø®Ù„ÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© ======
    ImageIcon backgroundIcon = new ImageIcon(getClass().getResource("gamee.png"));
    JLabel backgroundLabel = new JLabel(backgroundIcon);
    backgroundLabel.setLayout(null); // ØªØµÙ…ÙŠÙ… ÙŠØ¯ÙˆÙŠ

    // ====== Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± ======
    gameTimerLabel = new JLabel("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: 45 Ø«Ø§Ù†ÙŠØ©");
    gameTimerLabel.setFont(new Font("Arial", Font.BOLD, 16));
    gameTimerLabel.setForeground(Color.WHITE);
    gameTimerLabel.setBounds(10, 10, 250, 40); // Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±

    // ====== Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙƒÙˆØ± Ø£Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† ======
    scoreModel = new DefaultListModel<>();
    scoreList = new JList<>(scoreModel);
    scoreList.setFont(new Font("Arial", Font.BOLD, 18));
    scoreList.setForeground(Color.WHITE);
    scoreList.setOpaque(false);
    scoreList.setBackground(new Color(0, 0, 0, 0));
    scoreList.setCellRenderer(new DefaultListCellRenderer() {
        @Override
        public Component getListCellRendererComponent(JList<?> list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {
            JLabel label = (JLabel) super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);
            label.setHorizontalAlignment(SwingConstants.CENTER);
            label.setForeground(Color.WHITE);
            label.setFont(new Font("Arial", Font.BOLD, 18));
            label.setOpaque(false);
            return label;
        }
    });

    JScrollPane scoreScrollPane = new JScrollPane(scoreList);
    scoreScrollPane.setBounds(580, 10, 200, 200);
    scoreScrollPane.setOpaque(false);
    scoreScrollPane.getViewport().setOpaque(false);
    scoreScrollPane.setBorder(null);

    for (String player : players) {
        scoreModel.addElement(player + " - 0");
    }

    // ====== Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ======
    questionLabel = new JLabel("Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„...", SwingConstants.CENTER);
    questionLabel.setFont(new Font("Arial", Font.BOLD, 22));
    questionLabel.setForeground(Color.DARK_GRAY);
    questionLabel.setBounds(100, 230, 600, 40);

    // ====== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ======
    JButton trueButton = new JButton("âœ” ØµØ­");
    styleButton(trueButton, new Color(255, 215, 0));
    trueButton.setBounds(260, 290, 80, 40);

    JButton falseButton = new JButton("âœ– Ø®Ø·Ø£");
    styleButton(falseButton, new Color(176, 127, 255));
    falseButton.setBounds(410, 290, 80, 40);

    trueButton.addActionListener(e -> {
        sendAnswer(true);
        disableAnswerButtons();
    });

    falseButton.addActionListener(e -> {
        sendAnswer(false);
        disableAnswerButtons();
    });

    // ====== Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ ======
    JButton leaveButton = new JButton("Ø®Ø±ÙˆØ¬");
    leaveButton.setFont(new Font("Arial", Font.BOLD, 16));
    leaveButton.setBackground(Color.DARK_GRAY);
    leaveButton.setForeground(Color.WHITE);
    leaveButton.setFocusPainted(false);
    leaveButton.setBounds(350, 360, 100, 40);

    leaveButton.addActionListener(e -> sendLeaveRequest());

    // ====== Ø¥Ø¶Ø§ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© ======
    backgroundLabel.add(gameTimerLabel);
    backgroundLabel.add(scoreScrollPane);
    backgroundLabel.add(questionLabel);
    backgroundLabel.add(trueButton);
    backgroundLabel.add(falseButton);
    backgroundLabel.add(leaveButton);

    if (waitingRoomFrame != null) waitingRoomFrame.dispose();

    gameFrame.setContentPane(backgroundLabel);
    gameFrame.setVisible(true);
}




    private void styleButton(JButton button, Color color) {
        button.setBackground(color);
        button.setForeground(Color.WHITE);
        button.setFont(new Font("Arial", Font.BOLD, 14));
        button.setFocusPainted(false);
        button.setBorder(BorderFactory.createEmptyBorder(10, 20, 10, 20));
    }

  
  
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
    private void updateScores(String[] scores) {
        SwingUtilities.invokeLater(() -> {
            scoreModel.clear();
            for (String s : scores) {
                scoreModel.addElement(s);
            }
        });
    }

    //end gui 
    
    
    
    
    
    
    
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
    private void processMessage(String message) {
    System.out.println("Received from server: " + message);

    if (message.startsWith("PLAYERS:")) {
        String players = message.substring(8).trim();
        updatePlayersList(players);
    } else if (message.startsWith("WAITING ROOM:")) {
        String players = message.substring(13).trim();
        updateWaitingRoomList(players);
    } else if (message.startsWith("START_GAME_WITH:")) {
        String playersStr = message.substring("START_GAME_WITH:".length()).trim();
        String[] players = playersStr.split(",");
        startGameWindow(players);
    } else if (message.startsWith("QUESTION:")) {
        String question = message.substring("QUESTION:".length()).trim();
        SwingUtilities.invokeLater(() -> {
            questionLabel.setText(question);
            enableAnswerButtons();
        });
    } else if (message.startsWith("SCORE_UPDATE:")) {
        String[] scores = message.substring("SCORE_UPDATE:".length()).trim().split(",");
        updateScores(scores);
    } else if (message.startsWith("WINNER:")) {
    String winner = message.substring(7).trim();
    SwingUtilities.invokeLater(() -> {
        if(gameFrame != null) gameFrame.dispose();
        JFrame winnerFrame = new JFrame("Ø§Ù„ÙØ§Ø¦Ø²!");
        winnerFrame.setSize(800, 600);
        winnerFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        winnerFrame.setLocationRelativeTo(null);

        // Ø§Ù„Ø®Ù„ÙÙŠØ©
        ImageIcon backgroundIcon = new ImageIcon(getClass().getResource("gamee.png"));
        JLabel backgroundLabel = new JLabel(backgroundIcon);
        backgroundLabel.setLayout(null);

        // Ù†Øµ Ø§Ù„ÙØ§Ø¦Ø²
        JLabel winnerLabel = new JLabel("Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ: " + winner, SwingConstants.CENTER);
        winnerLabel.setFont(new Font("Arial", Font.BOLD, 32));
        winnerLabel.setForeground(new Color(255, 215, 0)); // Ø°Ù‡Ø¨ÙŠ
        winnerLabel.setBounds(200, 200, 400, 50);

        // Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
        JButton leaveButton = new JButton("Ø®Ø±ÙˆØ¬");
        leaveButton.setFont(new Font("Arial", Font.BOLD, 16));
        leaveButton.setBackground(new Color(30, 30, 60)); // ÙƒØ­Ù„ÙŠ ØºØ§Ù…Ù‚
        leaveButton.setForeground(Color.WHITE);
        leaveButton.setFocusPainted(false);
        leaveButton.setBounds(350, 300, 100, 40);
        leaveButton.addActionListener(e -> sendLeaveRequest());

        backgroundLabel.add(winnerLabel);
        backgroundLabel.add(leaveButton);

        winnerFrame.setContentPane(backgroundLabel);
        winnerFrame.setVisible(true);
    });
}
else if (message.startsWith("TIMER:")) {
    int seconds = Integer.parseInt(message.substring("TIMER:".length()).trim());
    startWaitingRoomTimer(seconds);
}
 else if (message.startsWith("GAME_TIMER:")) {
    int secondsLeft = Integer.parseInt(message.substring("GAME_TIMER:".length()).trim());
    SwingUtilities.invokeLater(() -> 
        gameTimerLabel.setText("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: " + secondsLeft + " Ø«Ø§Ù†ÙŠØ©"));
    } else if (message.startsWith("Player left:")) {
    String playerName = message.substring("Player left:".length()).trim();
    SwingUtilities.invokeLater(() -> {
        JOptionPane.showMessageDialog(null, "ğŸ“¢ Ø§Ù„Ù„Ø§Ø¹Ø¨ " + playerName + " Ø®Ø±Ø¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©.", "Ù„Ø§Ø¹Ø¨ ØºØ§Ø¯Ø±", JOptionPane.INFORMATION_MESSAGE);

        // Ù†Ø­Ø°Ù Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³ÙƒÙˆØ±
        for (int i = 0; i < scoreModel.size(); i++) {
            String item = scoreModel.getElementAt(i);
            if (item.startsWith(playerName + " ")) { // Ù…Ø«Ù„Ø§ "Ahmad - 3"
                scoreModel.remove(i);
                break;
            }
        }
    });
}
    }

    private void enableAnswerButtons() {
    for (Component comp : answerButtonsPanel.getComponents()) {
        comp.setEnabled(true);
    }
}

private void disableAnswerButtons() {
    for (Component comp : answerButtonsPanel.getComponents()) {
        comp.setEnabled(false);
    }
}


    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
    private void updatePlayersList(String players) {
        SwingUtilities.invokeLater(() -> {
            playerListModel.clear();
            String[] playerNames = players.split(",");
            for (String player : playerNames) {
                player = player.trim();
                if (!player.isEmpty()) {
                    playerListModel.addElement(player);
                }
            }
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© ØºØ±ÙØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
    private void updateWaitingRoomList(String players) {
        SwingUtilities.invokeLater(() -> {
            waitingRoomListModel.clear();
            String[] playerNames = players.split(",");
            for (String player : playerNames) {
                player = player.trim();
                if (!player.isEmpty()) {
                    waitingRoomListModel.addElement(player);
                }
            }
        });
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…ØºØ§Ø¯Ø±Ø© Ù„Ù„Ø³ÙŠØ±ÙØ±
private void sendLeaveRequest() {
    if (out != null) {
        out.println("LEAVE");
    }
    // Ø¥ØºÙ„Ø§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    if (playersFrame != null) playersFrame.dispose();
    if (waitingRoomFrame != null) waitingRoomFrame.dispose();
    if (gameFrame != null) gameFrame.dispose();
    JOptionPane.showMessageDialog(null, "Ù„Ù‚Ø¯ ØºØ§Ø¯Ø±Øª Ø§Ù„Ù„Ø¹Ø¨Ø©.", "Ù…ØºØ§Ø¯Ø±Ø©", JOptionPane.INFORMATION_MESSAGE);
    System.exit(0);
}

    // Ø¯Ø§Ù„Ø© ØªØ¶ÙŠÙ Ø²Ø± Ø®Ø±ÙˆØ¬ ØªØ­Øª ÙŠØ³Ø§Ø± Ø£ÙŠ Ù†Ø§ÙØ°Ø©
private void addLeaveButton(JFrame frame) {
    JButton leaveButton = new JButton("Ø®Ø±ÙˆØ¬");
    leaveButton.setBackground(Color.RED);
    leaveButton.setForeground(Color.WHITE);
    leaveButton.setFont(new Font("Arial", Font.BOLD, 14));
    leaveButton.setPreferredSize(new Dimension(80, 30)); // Ø­Ø¬Ù… Ø§Ù„Ø²Ø±

    leaveButton.addActionListener(e -> sendLeaveRequest());

    JPanel bottomPanel = new JPanel(new FlowLayout(FlowLayout.LEFT)); // ÙŠØ³Ø§Ø±
    bottomPanel.add(leaveButton);
    frame.add(bottomPanel, BorderLayout.SOUTH);
}

    
    private void startWaitingRoomTimer(int seconds) {
    new Thread(() -> {
        try {
            for (int i = seconds; i >= 0; i--) {
                final int timeLeft = i;
                SwingUtilities.invokeLater(() -> 
                    waitingRoomTimerLabel.setText("Ø§Ø³ØªØ¹Ø¯ ØªØ¨Ù‚Ù‰" + timeLeft + " Ø«Ø§Ù†ÙŠØ©")
                );
                Thread.sleep(1000);
            }
        } catch (InterruptedException ex) {
            ex.printStackTrace();
        }
    }).start();
}

    // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ù„Ø¹Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
    private void sendPlayRequest() {
        if (out != null) {
            out.println("play");
        } else {
            System.err.println("ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ù„Ø¹Ø¨: out ØºÙŠØ± Ù…Ù‡ÙŠØ£.");
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> new Client());
    }
}
